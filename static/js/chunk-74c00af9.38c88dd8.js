(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-74c00af9"],{"0835":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"d-flex"},[t.fileList.length?a("div",{staticClass:"d-flex"},t._l(t.fileList,(function(e,n){return a("div",{key:e.uuid,staticClass:"upload-block avatar d-flex justify-content-center align-items-center position-relative me-3"},[a("img",{staticClass:"avatar position-absolute top-0 start-0",attrs:{src:e.link,alt:""}}),a("div",{staticClass:"avatar hide justify-content-center align-items-center position-absolute top-0 start-0",staticStyle:{"background-color":"rgba(0,0,0,0.6)"}},[a("i",{staticClass:"el-icon-zoom-in fs-5 me-2 cursor-pointer text-white-50",on:{click:function(a){return t.handlePictureCardPreview(e.url)}}}),a("i",{staticClass:"el-icon-delete fs-5 cursor-pointer text-white-50",on:{click:function(a){return t.handleRemove(e.url,n)}}})])])})),0):t._e(),t.fileList.length<t.countLimit?a("label",{staticClass:"avatar-uploader position-relative",attrs:{for:"image-uploader-"+t.inputId,tabindex:"0"}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"}),a("input",{staticClass:"el-upload__input",attrs:{id:"image-uploader-"+t.inputId,type:"file",name:"image-uploader",accept:".jpg, .jpeg, .png",disabled:t.fileList.length===t.countLimit},on:{change:t.beforeImageUpload}})]):t._e()]),a("p",{staticClass:"my-0"},[t._v("只能上傳 jpg/png，大小不超過 5MB，尺寸 1000px * 800px")]),a("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1)},i=[],r=(a("caad"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("a434"),a("b0c0"),a("91b6")),o={name:"ImageUpload",props:{isMultiple:{type:Boolean,default:!1},fileList:{type:Array,required:!0}},data:function(){return{percentage:0,dialogVisible:!1,dialogImageUrl:""}},computed:{countLimit:function(){return this.isMultiple?3:1},inputId:function(){return(new Date).valueOf()}},methods:{beforeImageUpload:function(t){var e=this,a=t.target.files[0],n=["image/jpeg","image/jpg","image/png"].includes(a.type),i=5242880,r=a.size<i,o=this.fileList.length<this.countLimit;if(n)if(r)if(o){var l=new Image;l.onload=function(){var t=l.width,i=l.height;t>1e3||i>800?e.$message.error("圖片尺寸超過限制"):n&&r&&o&&e.uploadImage(a)},l.src=window.URL.createObjectURL(a)}else this.$message.error("圖片上限 ".concat(this.countLimit," 張"));else this.$message.error("圖片容量不能超過 5MB");else this.$message.error("圖片格式須為 jpg, jpeg, png")},handleRemove:function(t,e){this.fileList.splice(e,1)},handlePictureCardPreview:function(t){this.dialogImageUrl=t,this.dialogVisible=!0},uploadImage:function(t){var e=this,a=this.$loading({lock:!0,spinner:"el-icon-loading fs-1",background:"rgba(0, 0, 0, 0.7)"}),n=new FormData;n.append("image",t),Object(r["a"])(n).then((function(n){var i={name:t.name,link:n.image_link,category:e.isMultiple?"Content":"List",uuid:(new Date).valueOf()};e.fileList.length<e.countLimit&&e.fileList.push(i),a.close()})).catch((function(t){console.log(t),a.close()}))}}},l=o,s=(a("11ba"),a("2877")),c=Object(s["a"])(l,n,i,!1,null,null,null);e["a"]=c.exports},"095c":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("TinyEditor",{attrs:{"api-key":"mi512enaed3bnt81xitalewoqtf3nr5j0p9jlahxntts4m08",init:t.initOption},model:{value:t.editorContent,callback:function(e){t.editorContent=e},expression:"editorContent"}})},i=[],r=a("ca72"),o=a("91b6"),l={name:"Editor",components:{TinyEditor:r["a"]},props:{content:{type:String,default:""}},data:function(){return{editorContent:"",initOption:{height:300,menubar:!1,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount"],toolbar:"undo redo | fontselect fontsizeselect formatselect | bold italic forecolor backcolor |           alignleft aligncenter alignright alignjustify | image |           bullist numlist outdent indent | removeformat | code",images_upload_handler:this.uploadImage}}},watch:{editorContent:function(t){this.$emit("on-change",t)},content:{immediate:!0,handler:function(t){this.editorContent=t}}},methods:{uploadImage:function(t,e,a,n){var i=new FormData;i.append("image",t.blob(),t.filename()),Object(o["a"])(i).then((function(t){e(t.image_link)})).catch((function(t){console.log(t),a("image upload error")}))}}},s=l,c=a("2877"),u=Object(c["a"])(s,n,i,!1,null,null,null);e["a"]=u.exports},"11ba":function(t,e,a){"use strict";a("8810")},8810:function(t,e,a){},"91b6":function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));var n=a("b775");function i(t){return Object(n["a"])({url:"upload/",method:"post",data:t,headers:{"Content-type":"multipart/form-data"}})}},bebf:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.isLoading,expression:"isLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"app-container"},[a("el-form",{ref:"form",attrs:{model:t.form,rules:t.formRules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"景點名稱",prop:"title"}},[a("el-input",{attrs:{placeholder:"請輸入景點名稱"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),a("el-form-item",{attrs:{label:"景點副標",prop:"subTitle"}},[a("el-input",{attrs:{placeholder:"請輸入景點副標"},model:{value:t.form.subTitle,callback:function(e){t.$set(t.form,"subTitle",e)},expression:"form.subTitle"}})],1),a("el-form-item",{attrs:{label:"內容標題",prop:"contentTitle"}},[a("el-input",{attrs:{placeholder:"請輸入內容標題"},model:{value:t.form.contentTitle,callback:function(e){t.$set(t.form,"contentTitle",e)},expression:"form.contentTitle"}})],1),a("el-form-item",{attrs:{label:"景點清單圖片",prop:"listImage"}},[a("ImageUpload",{attrs:{"file-list":t.form.listImage}})],1),a("el-form-item",{attrs:{label:"景點內頁圖片",prop:"contentImage"}},[a("ImageUpload",{attrs:{"file-list":t.form.contentImage,"is-multiple":""}})],1),a("el-form-item",{attrs:{label:"內容描述",prop:"contentArticle"}},[a("Editor",{attrs:{content:t.form.contentArticle},on:{"on-change":function(e){return t.setInputValue("contentArticle",e)}}})],1),a("el-form-item",{attrs:{label:"聯繫方式",prop:"contactArticle"}},[a("Editor",{attrs:{content:t.form.contactArticle},on:{"on-change":function(e){return t.setInputValue("contactArticle",e)}}})],1),a("el-form-item",{attrs:{label:"相關資訊",prop:"relatedArticle"}},[a("Editor",{attrs:{content:t.form.relatedArticle},on:{"on-change":function(e){return t.setInputValue("relatedArticle",e)}}})],1),a("el-form-item",{attrs:{label:"景點地圖"}},[a("el-col",{staticClass:"text-center",attrs:{span:2}},[a("span",[t._v("Lat")])]),a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{prop:"lat"}},[a("el-input",{attrs:{placeholder:"請輸入緯度"},model:{value:t.form.map.lat,callback:function(e){t.$set(t.form.map,"lat",e)},expression:"form.map.lat"}})],1)],1),a("el-col",{staticClass:"text-center",attrs:{span:2}},[a("span",[t._v("Lng")])]),a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{prop:"lng"}},[a("el-input",{attrs:{placeholder:"請輸入經度"},model:{value:t.form.map.lng,callback:function(e){t.$set(t.form.map,"lng",e)},expression:"form.map.lng"}})],1)],1),a("el-col",{staticClass:"mt-3",attrs:{span:12}},[a("el-input",{ref:"placeQuery",attrs:{placeholder:"請輸入地址搜尋"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getLatLngByQuery(e)}},model:{value:t.placeQuery,callback:function(e){t.placeQuery=e},expression:"placeQuery"}})],1),a("el-col",{staticClass:"mt-3 ms-3",attrs:{span:2}},[a("el-button",{on:{click:t.getLatLngByQuery}},[t._v("搜尋")])],1),a("el-col",{staticClass:"mt-3",attrs:{span:24}},[a("GmapMap",{staticStyle:{width:"500px",height:"300px"},attrs:{center:t.center,zoom:14,"map-type-id":"terrain"}},[a("GmapMarker",{attrs:{position:t.center,clickable:!0,draggable:!1}})],1)],1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(t._s(t.isCreate?"新增":"儲存"))]),a("el-button",{on:{click:t.gotoList}},[t._v("取消")])],1)],1)],1)},i=[],r=(a("d81d"),a("095c")),o=a("0835"),l=a("755e"),s=a("cf7d"),c={name:"AttractionCreate",components:{Editor:r["a"],ImageUpload:o["a"]},data:function(){var t=function(t,e,a){if(0===e.length)return a(new Error("請上傳圖片"));a()};return{isLoading:!1,placeQuery:"",form:{title:"",subTitle:"",contentTitle:"",contentArticle:"",contactArticle:"",relatedArticle:"",listImage:[],contentImage:[],status:1,map:{lat:22.445759,lng:120.473509}},formRules:{title:[{required:!0,message:"請輸入景點名稱",trigger:"blur"}],contentTitle:[{required:!0,message:"請輸入內容標題",trigger:"blur"}],contentArticle:[{required:!0,message:"請輸入內容描述",trigger:"blur"}],listImage:[{required:!0,validator:t,trigger:"blur"}],contentImage:[{required:!0,validator:t,trigger:"blur"}]},isCreate:!1}},computed:{center:function(){var t=this.form.map,e=t.lat,a=t.lng;return{lat:parseFloat(e),lng:parseFloat(a)}}},created:function(){var t=this.$route.params.id;this.isCreate=!t,t&&this.getAttractionDetail(t)},methods:{getAttractionDetail:function(t){var e=this;this.isLoading=!0,Object(s["b"])(t).then((function(t){e.form=t.attraction,e.isLoading=!1})).catch((function(){e.isLoading=!1}))},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(!e)return t.$message.error("請確認必填欄位輸入完整"),!1;t.isLoading=!0;var a=t.isCreate?s["e"]:s["d"],n=t.$route.params.id;a(t.form,n).then((function(){t.$message({type:"success",message:"儲存成功"}),t.$router.push({name:"AttractionList"})})).catch((function(){t.isLoading=!1}))}))},setInputValue:function(t,e){this.form[t]=e},getLatLngByQuery:function(){var t=this,e=Object(l["gmapApi"])(),a=new e.maps.Geocoder;a.geocode({address:this.placeQuery},(function(e,a){if("OK"===a){var n=e[0].geometry.location,i=n.lat,r=n.lng;t.form.map={lat:i(),lng:r()}}else t.$message.error("無法辨識輸入的地址或關鍵字")}))},gotoList:function(){var t=this;this.$confirm("確定返回列表嗎？資料將不會儲存").then((function(){t.$router.push({name:"AttractionList"})}))}}},u=c,m=a("2877"),p=Object(m["a"])(u,n,i,!1,null,null,null);e["default"]=p.exports},cf7d:function(t,e,a){"use strict";a.d(e,"c",(function(){return r})),a.d(e,"b",(function(){return o})),a.d(e,"e",(function(){return l})),a.d(e,"d",(function(){return s})),a.d(e,"a",(function(){return c}));var n=a("5530"),i=a("b775");function r(t,e,a){return Object(i["a"])({url:"attraction/list/",method:"post",data:Object(n["a"])({page:t,numberPerPage:e},a)})}function o(t){return Object(i["a"])({url:"attraction/".concat(t),method:"get"})}function l(t){return Object(i["a"])({url:"attraction/",method:"post",data:t})}function s(t,e){return Object(i["a"])({url:"attraction/".concat(e),method:"patch",data:t})}function c(t){return Object(i["a"])({url:"attraction/",method:"delete",data:{id:t}})}}}]);